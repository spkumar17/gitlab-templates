.build_python_template:
  stage: build
  image: python:3.11-alpine
  variables:
    PYTHONUNBUFFERED: 1
  
  script:
    - apk add --no-cache build-base
    - echo "--- Installing dependencies ---"
    - |
      if [ -f requirements.txt ]; then
        pip install --no-cache-dir -r requirements.txt
      else
        echo "No requirements.txt found. Skipping dependency installation."
      fi
    - mkdir -p $CI_PROJECT_DIR/python_packages
    - cp -r /usr/lib/python3.11/site-packages/* $CI_PROJECT_DIR/python_packages/  

  artifacts:
    when: always
    paths:
      - $CI_PROJECT_DIR/
    expire_in: 1 day

  cache:
    key: "pip-$CI_COMMIT_REF_SLUG"
    paths:
      - ~/.cache/pip
    policy: pull-push

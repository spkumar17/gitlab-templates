# --------------------------------------------------------------------
# Trivy File System Scan Template
# --------------------------------------------------------------------
# This job uses the Trivy scanner to perform a filesystem-level scan 
# of the source code directory (`.`). It helps detect vulnerabilities 
# in project dependencies (e.g., package-lock.json, pom.xml, etc.).
# --------------------------------------------------------------------
# --------------------------------------------------------------------
.trivy-filescan:
  image: ubuntu:22.04
  stage: filescan
  before_script:
    - apt-get update -y
    - apt-get install -y curl ca-certificates
    - curl -sfL https://raw.githubusercontent.com/aquasecurity/trivy/main/contrib/install.sh | sh -s -- -b /usr/local/bin
  script:
    - echo "Starting Trivy file system scan..."
    - trivy fs --format table -o trivyfs-$CI_JOB_NAME.html .
    - echo "Scan complete. Report saved to trivyfs-$CI_JOB_NAME.html"
  artifacts:
    paths:
      - trivyfs-$CI_JOB_NAME.html
    expire_in: 1 day
    when: always

# --------------------------------------------------------------------
# Trivy File System Scan Template
# --------------------------------------------------------------------
# This job uses the Trivy scanner to perform a filesystem-level scan 
# of the source code directory (`.`). It helps detect vulnerabilities 
# in project dependencies (e.g., package-lock.json, pom.xml, etc.).
# --------------------------------------------------------------------
# --------------------------------------------------------------------

.trivy-filescan:
  image: ubuntu:latest
  stage: filescan
  script:
    - echo "Starting Trivy file system scan..."
    - ls -la
    - |
      echo "Install Trivy"
      curl -sfL https://raw.githubusercontent.com/aquasecurity/trivy/main/contrib/install.sh | sh -s -- -b /usr/local/bin
      echo "Run scan"
      trivy fs --format html -o trivyfs-$CI_JOB_NAME.html .
  artifacts:
    paths:
      - trivyfs-$CI_JOB_NAME.html 
    expire_in: 1 day
    when: always

  